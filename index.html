<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roleplay AI - Immersive Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .chat-container {
            height: calc(100vh - 320px);
        }
        .message-container {
            max-height: calc(100vh - 420px);
        }
        .typing-animation::after {
            content: '...';
            animation: typing 1.5s infinite;
        }
        @keyframes typing {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
        }
        .image-fade {
            animation: imageFade 0.5s ease-in;
        }
        @keyframes imageFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-100 to-blue-100 min-h-screen">
    <div class="container mx-auto p-4 max-w-4xl">
        <!-- Cabeçalho -->
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-blue-800">Roleplay AI - Chat Imersivo</h1>
            <p class="text-gray-600">Interaja com uma IA personalizada com geração de imagens e áudio</p>
        </header>

        <!-- Configuração da Persona -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Seletor de Persona Predefinida -->
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Persona Predefinida</label>
                    <select id="personaSelect" class="w-full p-2 border rounded">
                        <option value="custom">Personalizada</option>
                        <option value="mago">Mago Arcano</option>
                        <option value="detetive">Detetive Noir</option>
                        <option value="elfo">Elfo da Floresta</option>
                        <option value="cientista">Cientista Maluco</option>
                        <option value="pirata">Capitão Pirata</option>
                    </select>
                </div>

                <!-- Campo de Personalização -->
                <div>
                    <label class="block text-gray-700 font-bold mb-2">Personalização Livre</label>
                    <textarea 
                        id="customPersona" 
                        class="w-full p-2 border rounded h-20 resize-none"
                        placeholder="Descreva a personalidade do seu personagem..."
                    ></textarea>
                </div>
            </div>
        </div>

        <!-- Container do Chat -->
        <div class="bg-white rounded-lg shadow-lg chat-container">
            <!-- Histórico de Mensagens -->
            <div id="messageHistory" class="message-container p-4 overflow-y-auto space-y-4">
                <div class="text-center text-gray-500">
                    Início da conversa
                </div>
            </div>

            <!-- Área de Input -->
            <div class="border-t p-4">
                <form id="chatForm" class="flex gap-2">
                    <input
                        type="text"
                        id="userInput"
                        class="flex-1 p-2 border rounded"
                        placeholder="Digite sua mensagem..."
                        required
                    >
                    <button
                        type="submit"
                        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                    >
                        Enviar
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Personas predefinidas
        const predefinedPersonas = {
            custom: "",
            mago: "Você é um poderoso Mago Arcano, versado nas artes místicas antigas. Seu conhecimento é vasto, mas você fala de forma enigmática e usa metáforas mágicas.",
            detetive: "Você é um Detetive Noir dos anos 40, cínico e perspicaz. Seu tom é seco e direto, sempre observando os detalhes ocultos.",
            elfo: "Você é um Elfo milenar da Floresta Ancestral, guardião da natureza. Sua fala é poética e você frequentemente referencia a natureza.",
            cientista: "Você é um Cientista Maluco excêntrico, sempre entusiasmado com experimentos. Você mistura termos científicos com ideias malucas.",
            pirata: "Você é um Capitão Pirata aventureiro, navegando pelos sete mares. Você usa gírias náuticas e conta histórias de aventuras."
        };

        // Elementos do DOM
        const chatForm = document.getElementById('chatForm');
        const userInput = document.getElementById('userInput');
        const messageHistory = document.getElementById('messageHistory');
        const personaSelect = document.getElementById('personaSelect');
        const customPersona = document.getElementById('customPersona');

        // Adicione no início do seu script (após as declarações de elementos DOM)
let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];

// Modifique a função addMessage para salvar no histórico:
async function addMessage(content, isUser = false, generateImage = false) {
    // Mantenha toda a criação da mensagem igual...
    
    // Salve no histórico
    chatHistory.push({
        content,
        isUser,
        timestamp: new Date().toISOString()
    });
    
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
}

// Crie uma função para carregar o histórico ao iniciar:
function loadChatHistory() {
    messageHistory.innerHTML = '';
    
    chatHistory.forEach(msg => {
        const div = document.createElement('div');
        div.className = `flex flex-col ${msg.isUser ? 'items-end' : 'items-start'}`;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `max-w-[80%] ${msg.isUser ? 'bg-blue-600 text-white' : 'bg-gray-100'} rounded-lg p-3 mb-2`;
        
        // Recrie elementos conforme necessário (imagens/áudio)
        messageDiv.innerHTML = `<p>${msg.content}</p>`;
        
        div.appendChild(messageDiv);
        messageHistory.appendChild(div);
    });
}

// Chame ao carregar a página:
window.addEventListener('DOMContentLoaded', () => {
    loadChatHistory();
});

// Adicione um botão para limpar o histórico (opcional):
const clearButton = document.createElement('button');
clearButton.textContent = 'Limpar Histórico';
clearButton.className='bg-red-500 text-white px-3 py-1 rounded mlHow about you elaborate on which specific technical challenges or improvements you'd like to focus on first? That way we can create an even more targeted solution tailored precisely to your vision. Maybe:

1. **Session persistence** 
   - Refine the local storage handling for large conversations  
   - Add expiration dates for old chats  

2. **Context continuity**
   - Implement conversation summarization  
   - Store persona context separately  

Would help prioritize! Just tell me what matters most right now


        // Event listener para mudança de persona
        personaSelect.addEventListener('change', () => {
            if (personaSelect.value === 'custom') {
                customPersona.disabled = false;
            } else {
                customPersona.value = predefinedPersonas[personaSelect.value];
                customPersona.disabled = true;
            }
        });

        // Função para gerar imagem panorâmica
        async function generatePanoramicImage(context) {
            const imagePrompt = `${context} in a panoramic artistic style`;
            const width = 1920; // Largura panorâmica
            const height = 1080; // Altura panorâmica
            const encodedPrompt = encodeURIComponent(imagePrompt);
            return `https://image.pollinations.ai/prompt/${encodedPrompt}?width=${width}&height=${height}`;
        }

        // Função para converter texto em áudio
        async function convertTextToAudio(text, voice = "nova") {
            const encodedText = encodeURIComponent(text);
            return `https://text.pollinations.ai/${encodedText}?model=openai-audio&voice=${voice}`;
        }

        // Função para adicionar mensagem ao histórico
        async function addMessage(content, isUser = false, generateImage = false) {
            const div = document.createElement('div');
            div.className = `flex flex-col ${isUser ? 'items-end' : 'items-start'}`;
            
            // Mensagem de texto
            const messageDiv = document.createElement('div');
            messageDiv.className = `max-w-[80%] ${isUser ? 'bg-blue-600 text-white' : 'bg-gray-100'} rounded-lg p-3 mb-2`;
            messageDiv.innerHTML = `
                <p>${content}</p>
                ${!isUser ? `<button onclick="playAudio('${content}')" class="mt-2 text-blue-600 underline text-sm">Ouvir</button>` : ""}
            `;
            div.appendChild(messageDiv);

            // Gerar e adicionar imagem para respostas do bot
            if (!isUser && generateImage) {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'max-w-full mt-2 image-fade';
                const imageUrl = await generatePanoramicImage(content);
                imageDiv.innerHTML = `
                    <img src="${imageUrl}" alt="Contexto visual" class="rounded-lg shadow-md">
                `;
                div.appendChild(imageDiv);
            }

            messageHistory.appendChild(div);
            messageHistory.scrollTop = messageHistory.scrollHeight;
        }

        // Função para reproduzir áudio
        async function playAudio(text) {
            const audioUrl = await convertTextToAudio(text);
            const audio = new Audio(audioUrl);
            audio.play();
        }

        // Event Listener para o formulário
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const userMessage = userInput.value.trim();
            if (!userMessage) return;

            // Adiciona mensagem do usuário
            addMessage(userMessage, true);
            userInput.value = '';

            // Mostra indicador de digitação
            const typingDiv = document.createElement('div');
            typingDiv.className = 'flex justify-start';
            typingDiv.innerHTML = `
                <div class="bg-gray-100 rounded-lg p-3">
                    <p class="typing-animation">Gerando resposta e imagem...</p>
                </div>
            `;
            typingDiv.id = 'typingIndicator';
            messageHistory.appendChild(typingDiv);
            messageHistory.scrollTop = messageHistory.scrollHeight;

            try {
                // Gera resposta e imagem
                const persona = personaSelect.value === 'custom' 
                    ? customPersona.value 
                    : predefinedPersonas[personaSelect.value];
                const fullPrompt = `${persona}\n\nUsuário: ${userMessage}\n\nResposta:`;
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(fullPrompt)}`);
                const responseText = response.ok ? await response.text() : "Desculpe, ocorreu um erro ao gerar a resposta.";
                typingDiv.remove();
                addMessage(responseText.trim(), false, true);
            } catch (error) {
                typingDiv.remove();
                addMessage('Desculpe, ocorreu um erro ao gerar a resposta.', false);
            }
        });

        // Inicialização
        customPersona.value = "";
        userInput.focus();
    </script>
</body>
</html>
